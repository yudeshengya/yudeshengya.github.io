(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{526:function(A,t){A.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA6QAAAIhCAYAAABZtXcCAAAYDklEQVR4nO3da3KjSLcFUPuGZ8QQctw5Nn8/6ipaRfFInhvQWhEd0ZbSh4NRIW9ngr67rvv9AgAAgJP9X7oBAAAAPpNACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQIRACgAAQMRPuoEhtdbJ50spzWPVUUcdddRRR53r1HkfCwDfXdf9ppvoq7V6wwKAh/H+DkCfJbsAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABEXPJzSAEAAHg+M6QAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABEPDqQ1lrTLQAX4pwAAHAtjw6kAAAAXJdACgAAQMSlA6nldQAAAM916UBaShFKP1jLsa+1eo0AAMBNXTqQfn0JpQAAAE91+UD69SWUMq6U8lVKSbcBAACs8NM6cC4QvoeCLeFxLFy8Qqnw8Xzvr5/3/+8f+9bn+oZeQ2O1hh5vGTu3PQAAYEEg/fpq/8X6qF/AhdLP8B78po71UEB8f+79+8f+f+7r/jb6dcZqvD8OAAAMu8WSXTjKUJAcWyLeH9vyhxF/PAEAgHGLZkjTzI5yhNZZzLnZ2qklxAAAwL9uE0iFUY6y1+tq6HpSr1kAABh3iyW7wih387r7r2tIAQBg3OUDqTDKyxHhbup60SUETwAAWO7SS3aF0c82d13m0MfDzN0Vd+j/h0Lp2J10h/oY6mesZwAA4D/fXdf9tgy8Yzi8Y8/AcZwTAACupTmQAgAAwJ4ufw0pAAAAzySQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAENEcSGutR/ax2NX6AQC28/4O8FnMkAIAABAhkAIAABAhkAIAABAhkAIAABAhkAIAABAhkAIAABDxk25gi6lbw5dSmsbNUUcdddRRRx11rlMHgGf57rrut2VgrfWvNxOAszj/AAA8kyW7AAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARDR/DikAAADsyQwpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEc2BtNZ6ZB8Ao5x/AACeyQwpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAEQIpAAAAET/pBtaa+xiIUkrzWHXUUef6daaev/N+qaOOOtNjAXi2767rflsG1lov9QZxtX4AgO28vwN8Fkt2AQAAiBBIAQAAiBBIAQAAiBBIAQAAiBBIAQAAiBBIAQAAiBBIAQAAiGj+HFIAAADYkxlSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIpoDaa31yD4Wu1o/QJZzAgDA/ZghBQAAIEIgBQAAIEIghf/XsuTTslAAANjPT7oBrukVvEopTY/f2dYgevbP5InHAACAz2SGlEGfFHZKKbP7OzXm7J/VJx0bAACezQwpiwhDAADAXgTSC3pfkvm+VHQsDI6NGaszVmtuW1PPL9nW2PLXNWF36baODtRLfoZT/Szpe+749/mjAgAAVyGQXtAr1NVa/wkYQ4FrbMxYnbnve3091NfUcy3bauml1ZnbWtPPmuO35LF3rePdlAkAgCtxDemF9QNFf/ZxKHS0zoa+G6uzxpk39mm57vNMc8eipZ+lgXnpeLOjAABciRnSmzPj9bc7zAqu6Wfpfq0JwwAAcDaB9ObuFjTWzOBu0bIU+Ux79jO1NPn9+fft3O31AgDAswmkRJwRjI68XnSNZD9z4RUAABJcQ3ph/dmzfpgYmm0c+r45Q3WOnkl83QDp9d9Sa/b9jH3qf916d9yXNfuVOH4AALCH767rflsGXm1m5Wr97O21f0s/9uV9XMvHgUw93l/m2Xrn3bmaY9dDHv2xL0P7NFRjrs7QmNbj1dLP0PZajtP7uE/8yJennxMAAJ5IIL2op+7f3oEUXryGAADupzmQcp6n3x21ZUYSAAB4PoEUAACACDc1AgAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIKI5kNZaj+xjsav1AwBs5/0d4LOYIQUAACBCIAUAACBCIAUAACBCIAUAACBCIAUAACBCIAUAACDiJ93AFlO3hi+lNI2bo4466qijjjrqXKcOAM/y3XXdb8vAWutfbyYAZ3H+AQB4Jkt2AQAAiBBIAQAAiBBIAQAAiBBIAQAAiBBIAQAAiBBIAQAAiBBIAQAAiGj+HFIAAADYkxlSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIpoDaa31yD4ARjn/AAA8kxlSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIgRSAAAAIn7SDaw19zEQpZTmseqoo87160w9f+f9UkcddabHAvBs313X/bYMrLVe6g3iav0AANt5fwf4LJbsAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAENH8OaQAAACwJzOkAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARDQH0lrrkX0sdrV+gCznBACA+zFDCgAAQIRACgAAQIRAymKWRgIAAHv4STfAOV4hspSyerwgCgAA7MkMKYOGgmsppTnQAgAAzDFD+iEESQAA4GoE0g/wvtR2Kpi2jttre1vrl1JGtzX0+FRfc3WmtjVU46h+AADgSQTSDzAUgPpqrbtcLzpUZ+9A9QqHU9vq7/P7c/19m6szt62hr4/qBwAAnsQ1pAwGnjUBaKzOUTdDat1Wv6+5sDdUZ27Mkp/XHv0AAMATmCFlV1cMTnNhcc+eW2qd2Q8AAFyZQMqu7ri0dK+e91r2fMefIQAArGHJLuzAdZ4AALCcQMrgNYprZvemruF8//+9lqTO3QyoRUvPa7a1ZXa0pR8AAHiC767rflsGXm0G6Gr9XNlQmJn72JL3YDR1l961H3+y9di9jn/Lx75M9To2fuhGQ0s+9qX/89uzH4Y5JwAA3I9Ayun2OHZnHn+vtXtwnAAA7qc5kMIe9gqjL0cHkDO3BQAAn0YgBQAAIMJNjQAAAIgQSAEAAIgQSAEAAIgQSAEAAIgQSAEAAIgQSAEAAIgQSAEAAIgQSAEAAIgQSAEAAIgQSAEAAIgQSAEAAIgQSAEAAIhoDqS11iP7WOxq/QAA23l/B/gsZkgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACI+Ek3sMXUreFLKU3j5qijjjrqqKOOOtep8+nmfnZXO17qqKPOs+q8j93Ld9d1vy0Da62HNAAwx/kH4A/nQyDlqPOPJbsAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABENH8OKQAAAOzJDCkAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARzYG01npkHwCjnH8A/nA+5GheY5zNDCkAAAARAikAAAARAikAAAARAikAALuotd7uGsQ79gxPIpACAAAQ8ZNuAACAZyilpFtY7I49w5PcNpDOLa14P7lsWYahjjrqXKPO1PN33i911FFneiz38X5c+8fw9Vwp5Z/jP3S8l45pfX2N9bW157FtTtUE/vjuuu63ZWCt9VL/eK7WDwCwnff3aXf4+Yz1OBbG+uOHvn9uzNTXY/+/V88t/c7Vu5I7vMZ4FteQAgBwirmg0xKGhsYMzWLuZc9wVkoR9qBHIAUA4NKEOHiu215DCgAAaa3XxQLDBFIAANhICIV1LNkFAOASxq4F7d8Ntz/mCjfiqbX+9d/UGOA/ZkgBANjsPWj17yb7+nrobrj9x1uWwPbHzNWc+v+tPS+9cy/wN4EUAIDNpsLX2HNLH1/zve9fTz23Z29La8Ina/4cUgAA4F9Dy3CFT2gjkAIAABDhpkYAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABECKQAAABENAfSWuuRfSx2tX6ALOeE53FMOZrXGECeGVIAAAAiBFIAAAAiBFJur2XJlWVZzPEaAQA430+6AVhLEGUvtdavUkq6DThcy2v9dd70bwKAM5gh5bZKKbO/MLWM4bMJowAAOWZIgY8ljMK//JsA4EwCKad5Xwb2vpR27JefljGw1lwY3bLc+72uOsfVOVK/r6HXytg5auxc9z6uZUzLtlp7fn9uqlbreXfLvo/1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QETz55ACAADAnsyQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAECGQAgAAENEcSGutR/YR89T9AtZxTgAAOI8ZUgAAACIEUgAAACIEUhb75CWNLfv+yT8fAABY4ifdAPfxyUFraxB9PVdK2a2nll7O2h4AAKxhhpRmpZSPDTgt+z415uyf26ceJwAA7kUgBQAAIGLRkt2pJYnvMzJblnZerc4n6f+c1s6yvdcZqjF2PPpj5+qs6WduO1u3tbSflp/PWD9L+h7bZuuxAACAIzQH0iW/oO71y+wZdYTVP2qtg0Ft6THof8/c1++PL6mztp/+Y3vt99p+WvZzy2PvWsf7NwEAwFks2WW3ADZUp5TSFHDmQllrnbl+prZ7hrn9auln6fFaOt7sKAAAZ3GXXUYdEUxaA9iRs3R3mBVc08/S/VoThgEAYE8CKacbuoZxaObwLEPLZpP27GdqafL78+/bEUwBADiLJbtEvT4qJRUCj7xedI1kP+ljAQDA5xFIGQ0hS4PJUJ01s31H9jNX5+gwNvfzaelnzX6NHRsAAEj67rruN91E0tVmyJKWfjzK0Jj+uJYaLXXGxrRYsl/vwW0uSC/9+bxea0s+9mWsn6HtjfU7tk0f+TLMOQEA4DwCqV8+gTfOCQAA5/n4QAoAAECGa0gBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIEEgBAACIuGQgrbWmWwAAdub9HYC+SwZSAAAAnk8gBQAAIEIgBQAAIEIgBQAAIEIgBQAAIEIgBQAAIOIn3cCYqVvDl1Kaxs1RRx111FFHHXWuUweAz/Pddd1vugkAAAA+jyW7AAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARAikAAAARPwPRlgh+0LuCBAAAAAASUVORK5CYII="},609:function(A,t,s){"use strict";s.r(t);var n=s(6),a=Object(n.a)({},(function(){var A=this,t=A.$createElement,n=A._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":A.$parent.slotKey}},[n("h2",{attrs:{id:"事件循环机制的六大阶段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事件循环机制的六大阶段"}},[A._v("#")]),A._v(" 事件循环机制的六大阶段")]),A._v(" "),n("p",[A._v("Node.js 中的事件循环与浏览器中的是不一样的东西，它具体分为了六大阶段：")]),A._v(" "),n("img",{staticStyle:{zoom:"80%"},attrs:{src:s(526),alt:"image-20210205221532876"}}),A._v(" "),n("p",[A._v("事件循环机制会按照上图的顺序进入每个阶段，其中各个阶段都有一个队列用来存放和执行回调函数。当事件循环进入特定的阶段时，它将执行该阶段队列的回调，直到队列为空或最大回调数已执行。当队列为空或最大回调数已执行时，它将移入下个阶段。")]),A._v(" "),n("ul",[n("li",[A._v("timers 阶段：执行已经被 setTimeout 和 setInterval 的调度回调函数。定时器的时间不是回调函数执行的时间，而是回调函数添加到 timers 队列的时间。")]),A._v(" "),n("li",[A._v("pending callbacks 阶段：执行一些系统操作的回调。比如TCP错误。")]),A._v(" "),n("li",[A._v("idle，prepare阶段：仅系统内部使用。")]),A._v(" "),n("li",[A._v("poll 阶段：负责检索新的 I/O 事件，执行与 I/O 相关的回调。进入该阶段会执行 poll 队列内的所有任务，直至队列为空。当队列为空时会发生以下情况：\n"),n("ul",[n("li",[A._v("如果有 setImmediate 调度，将结束 poll 阶段，进入 check 阶段，执行 check 队列中的任务")]),A._v(" "),n("li",[A._v("如果没有 setImmediate 调度，将检查是否有已到达时间的定时器，如果有的话会绕回 timer 阶段去执行")]),A._v(" "),n("li",[A._v("如果没有 setImmediate，也没有已到达时间的定时器任务，此时将进入阻塞，等待事件的回调添加到队列中")])])]),A._v(" "),n("li",[A._v("check 阶段：setImmediate 回调会在 check 队列中排队，该阶段会在 poll 阶段结束后立即执行")])]),A._v(" "),n("h2",{attrs:{id:"process-nexttick"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#process-nexttick"}},[A._v("#")]),A._v(" process.nextTick()")]),A._v(" "),n("blockquote",[n("p",[A._v("process.nextTick 回调会保存一个单独的队列中")])]),A._v(" "),n("p",[A._v("可以将 process.nextTick 与 promise 联系起来，它们都属于微任务，都会在"),n("strong",[A._v("每个阶段执行完成后处理其队列")]),A._v("，不过 process.nextTick 优先与 promise 执行。这里注意不能递归 process.nextTick 调用，否则会饿死 I/O。")]),A._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[A._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("=>")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("{")]),A._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'timeout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(";")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(",")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[A._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(";")]),A._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[A._v("function")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("func")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("{")]),A._v("\n  process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("nextTick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("=>")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("{")]),A._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("func")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("}")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("func")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n")])]),A._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[A._v("1")]),n("br"),n("span",{staticClass:"line-number"},[A._v("2")]),n("br"),n("span",{staticClass:"line-number"},[A._v("3")]),n("br"),n("span",{staticClass:"line-number"},[A._v("4")]),n("br"),n("span",{staticClass:"line-number"},[A._v("5")]),n("br"),n("span",{staticClass:"line-number"},[A._v("6")]),n("br"),n("span",{staticClass:"line-number"},[A._v("7")]),n("br"),n("span",{staticClass:"line-number"},[A._v("8")]),n("br"),n("span",{staticClass:"line-number"},[A._v("9")]),n("br"),n("span",{staticClass:"line-number"},[A._v("10")]),n("br")])]),n("p",[A._v("这段代码中的 setTimeout 永远都不会执行，因为主线程一直在处理 process.nextTick 任务，不会进行 timer 阶段。")]),A._v(" "),n("blockquote",[n("p",[A._v("注意：在 node 版本 >= 11 的情况下，微任务执行时机是在每个宏任务执行完成后执行，也就和浏览器一样；而在小于 11 的版本中，执行时机是在每个阶段结束后执行")])]),A._v(" "),n("h2",{attrs:{id:"案例演示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#案例演示"}},[A._v("#")]),A._v(" 案例演示")]),A._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[A._v("const")]),A._v(" fs "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("=")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'fs'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(";")]),A._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("=>")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("{")]),A._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'timeout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(",")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[A._v("500")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("=>")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("{")]),A._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'immediate'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n\nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("readFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),A._v("__dirname "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("+")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'/test.txt'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(",")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[A._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(",")]),A._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("=>")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("{")]),A._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'poll'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'script'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n\nPromise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("=>")]),A._v(" console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'promise'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\nprocess"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("nextTick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[A._v("=>")]),A._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("{")]),A._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[A._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[A._v("'nextTick'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[A._v(")")]),A._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[A._v("// script")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[A._v("// nextTick")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[A._v("// promise")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[A._v("// immediate")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[A._v("// poll")]),A._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[A._v("// timeout")]),A._v("\n")])]),A._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[A._v("1")]),n("br"),n("span",{staticClass:"line-number"},[A._v("2")]),n("br"),n("span",{staticClass:"line-number"},[A._v("3")]),n("br"),n("span",{staticClass:"line-number"},[A._v("4")]),n("br"),n("span",{staticClass:"line-number"},[A._v("5")]),n("br"),n("span",{staticClass:"line-number"},[A._v("6")]),n("br"),n("span",{staticClass:"line-number"},[A._v("7")]),n("br"),n("span",{staticClass:"line-number"},[A._v("8")]),n("br"),n("span",{staticClass:"line-number"},[A._v("9")]),n("br"),n("span",{staticClass:"line-number"},[A._v("10")]),n("br"),n("span",{staticClass:"line-number"},[A._v("11")]),n("br"),n("span",{staticClass:"line-number"},[A._v("12")]),n("br"),n("span",{staticClass:"line-number"},[A._v("13")]),n("br"),n("span",{staticClass:"line-number"},[A._v("14")]),n("br"),n("span",{staticClass:"line-number"},[A._v("15")]),n("br"),n("span",{staticClass:"line-number"},[A._v("16")]),n("br"),n("span",{staticClass:"line-number"},[A._v("17")]),n("br"),n("span",{staticClass:"line-number"},[A._v("18")]),n("br"),n("span",{staticClass:"line-number"},[A._v("19")]),n("br"),n("span",{staticClass:"line-number"},[A._v("20")]),n("br"),n("span",{staticClass:"line-number"},[A._v("21")]),n("br"),n("span",{staticClass:"line-number"},[A._v("22")]),n("br"),n("span",{staticClass:"line-number"},[A._v("23")]),n("br"),n("span",{staticClass:"line-number"},[A._v("24")]),n("br"),n("span",{staticClass:"line-number"},[A._v("25")]),n("br"),n("span",{staticClass:"line-number"},[A._v("26")]),n("br"),n("span",{staticClass:"line-number"},[A._v("27")]),n("br")])]),n("ul",[n("li",[A._v('首先 Node.js 启动，它会初始化事件循环，处理脚本。打印 "script"，将 promise 和 nextTick 放入队列中。同步代码执行完成')]),A._v(" "),n("li",[A._v("取出微任务队列任务并执行，由于 "),n("strong",[A._v("nextTick 优先执行")]),A._v('，所以依次打印 "nextTick" 和 "promise"。接着正式进入事件循环')]),A._v(" "),n("li",[A._v('由于 timers 队列为空，事件循环来到 poll 阶段，发现poll队列也为空，但有 immediate 调度，结束poll阶段，打印"immediate"')]),A._v(" "),n("li",[A._v('第二轮事件循环阻塞在 poll 阶段，等待回调任务。然后文件读取完毕执行回调打印 "poll"，接着又阻塞在 poll 阶段')]),A._v(" "),n("li",[A._v('发现有定时器任务回调，进入 timer 阶段执行打印 "timeout"')])])])}),[],!1,null,null,null);t.default=a.exports}}]);